"""Add traveler profile table

Revision ID: 2e0ac7e0a7a7
Revises: 1414da92b3ca
Create Date: 2015-08-18 17:44:32.460413

"""

# revision identifiers, used by Alembic.
revision = '2e0ac7e0a7a7'
down_revision = '1414da92b3ca'

from alembic import op, context
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql
from sqlalchemy.types import Enum

def upgrade():

    fallback_mode = Enum('walking', 'car', 'bss', 'bike', name='fallback_mode')
    fallback_mode.create(bind=op.get_bind())

    ### commands auto generated by Alembic - please adjust! ###
    op.create_table('traveler_profile',
    sa.Column('coverage', sa.Text(), nullable=True),
    sa.Column('traveler_type', sa.Enum('standard', 'slow_walker', 'fast_walker', 'luggage',
                                       'wheelchair', 'cyclist', 'motorist',
                                       name='traveler_type'), nullable=False),
    sa.Column('walking_speed', sa.Float(), nullable=False),
    sa.Column('bike_speed', sa.Float(), nullable=False),
    sa.Column('bss_speed', sa.Float(), nullable=False),
    sa.Column('car_speed', sa.Float(), nullable=False),
    sa.Column('wheelchair', sa.Boolean(), nullable=False),
    sa.Column('max_walking_duration_to_pt', sa.Integer(), nullable=False),
    sa.Column('max_bike_duration_to_pt', sa.Integer(), nullable=False),
    sa.Column('max_bss_duration_to_pt', sa.Integer(), nullable=False),
    sa.Column('max_car_duration_to_pt', sa.Integer(), nullable=False),
    sa.Column('first_section_mode', postgresql.ARRAY(fallback_mode), nullable=False),
    sa.Column('last_section_mode', postgresql.ARRAY(fallback_mode), nullable=False),
    sa.ForeignKeyConstraint(['coverage'], ['instance.name'], ),
    sa.PrimaryKeyConstraint('coverage', 'traveler_type'),
    sa.UniqueConstraint('coverage', 'traveler_type')
    )
    op.alter_column('user', 'end_point_id',
               existing_type=sa.INTEGER(),
               nullable=False)
    op.create_foreign_key(None, 'user', 'end_point', ['end_point_id'], ['id'])
    ### end Alembic commands ###


def downgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'user', type_='foreignkey')
    op.alter_column('user', 'end_point_id',
               existing_type=sa.INTEGER(),
               nullable=True)
    op.drop_table('traveler_profile')
    ### end Alembic commands ###
